name=anydesk
version=7.1.1
release=2
summary="The Fast Remote Desktop Application"
summary_ru="Приложение для быстрого удаленного доступа"
group="Other"
desc="Discover AnyDesk, the secure and intuitive remote desktop \
app with innovative features, perfect for seamless remote \
desktop application across devices."
desc_ru="Откройте для себя AnyDesk, безопасное ПО для удаленного \
доступа с интуитивно понятным управлением, и воспользуйтесь \
преимуществами инновационных функций приложения."
maintainer="Maxim Slipenko <maks1ms@alt-gnome.ru>"
architectures=("amd64")
homepage="https://anydesk.com"
license=("custom")

appstream_app_id='com.anydesk.Anydesk'

nonfree=1
nonfree_url="https://anydesk.com/ru/obshhie-komercheskie-uslovija"

provides=()
conflicts=()

deps=(
	libgtkglext
)

sources=(
	"https://download.anydesk.com/linux/anydesk-$version-amd64.tar.gz"
)

checksums=(
	'sha256:a46cd4e1d05e5a500200ebec841cd33cde8f70d7509105c08c61672becab280e'
)

auto_reqprov_method=dirty
auto_req=1
auto_prov=1

package() {
	install-binary "${srcdir}/anydesk-${version}/anydesk"
	install-desktop "${srcdir}/anydesk-${version}/anydesk.desktop"

	# workaround to fix crashes
	# sed -i 's/^Exec=/Exec=env GDK_BACKEND=x11 /' "${pkgdir}/usr/share/applications/anydesk.desktop"

	# install polkit action
	install -Dm 644 "${srcdir}/anydesk-${version}/polkit-1/com.anydesk.anydesk.policy" "${pkgdir}/usr/share/polkit-1/actions/com.anydesk.anydesk.policy"
	# install icon
	install -Dm 644 "${srcdir}/anydesk-${version}/icons/hicolor/scalable/apps/anydesk.svg" "${pkgdir}/usr/share/pixmaps/anydesk.svg"

	install-license "${srcdir}/anydesk-${version}/copyright" "${name}/LICENSE"
	install-systemd "${srcdir}/anydesk-${version}/systemd/anydesk.service"
}

files() {
	files-find \
		"/usr/bin/$name" \
		"/usr/share/applications/$name.desktop" \
		"/usr/share/licenses/$name" \
		"/usr/share/licenses/$name/*" \
		"/usr/share/pixmaps/$name.svg" \
		"/usr/lib/systemd/system/$name.service" \
		"/usr/share/polkit-1/actions/com.anydesk.anydesk.policy"
}
